# ===========================
# DEVICE CONFIGURATION
# ===========================
# Device Settings - Auto-detected, can be overridden
USE_CUDA=auto  # auto, true, or false
DEVICE=auto    # auto, cpu, or cuda

# ===========================
# MODEL PATHS
# ===========================
CLAIRE_MODEL_Q4_PATH=models/claire_v1.0.0_q4_k_m.gguf
CLAIRE_MODEL_F16_PATH=models/claire_v1.0.0_f16.gguf
LANGUAGE_MODEL_PATH=models/distilbert_language.pt
EMOTION_MODEL_PATH=models/distilbert_emotion.pt

# Model Selection
AUTO_SELECT_MODEL=true
SKIP_MODEL_LOADING=false  # Set to true for testing without models

# ===========================
# GGUF MODEL SETTINGS
# ===========================
MODEL_CONTEXT_SIZE=8192	# Context window (system prompt + user input + model's output)
MODEL_MAX_TOKENS=1024	# Model's output
MODEL_TEMPERATURE=0.6
MODEL_TOP_P=0.9
MODEL_REPEAT_PENALTY=1.3  # Increased to penalize repetition
MODEL_N_BATCH=512      # For GPU
MODEL_N_BATCH_CPU=256  # For CPU

# Additional generation penalties
FREQUENCY_PENALTY=0.1  # Penalize frequent tokens
PRESENCE_PENALTY=0.1   # Penalize already present tokens

# Model loading settings
MODEL_SEED=-1  # Random seed (-1 for random)
LOGITS_ALL=false  # Only compute logits for last token
VOCAB_ONLY=false  # Load full model
USE_EMBEDDING=false  # Not using for embeddings
MODEL_VERBOSE=false  # Verbose logging for model

# ===========================
# GPU SETTINGS
# ===========================
GPU_LAYERS=35  # Number of layers to offload to GPU (0 for CPU-only)
N_GPU_THREADS=8  # CPU threads for non-offloaded operations on GPU

# ===========================
# CPU OPTIMIZATION
# ===========================
OMP_NUM_THREADS=auto  # auto = use all cores
MKL_NUM_THREADS=auto
NUMEXPR_NUM_THREADS=auto
VECLIB_MAXIMUM_THREADS=auto
OPENBLAS_NUM_THREADS=auto
LLAMA_CPP_THREADS=auto  # auto = cores - 1
USE_MMAP=true  # Memory mapping for faster loading
USE_MLOCK=false  # Lock model in RAM (requires admin)
F16_KV_CPU=false  # Use fp32 for KV cache on CPU (faster)

# Tokenizer settings
TOKENIZERS_PARALLELISM=false  # Avoid tokenizer warnings

# ===========================
# API SETTINGS
# ===========================
API_V1_STR=/api/v1
PROJECT_NAME=CLAIRE-RAG [BACKEND]
VERSION=1.1.0
BACKEND_CORS_ORIGINS=["*"]  # Allow all origins

# ===========================
# EMBEDDING & VECTOR SEARCH
# ===========================
EMBEDDING_MODEL=sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
MAX_LENGTH=512
TOP_K=4
VECTOR_SEARCH_TIMEOUT=30

# ===========================
# TIMEOUT SETTINGS (seconds)
# ===========================
REQUEST_TIMEOUT=300
OCR_TIMEOUT=30
MODEL_INFERENCE_TIMEOUT=120  # For GPU
MODEL_INFERENCE_TIMEOUT_CPU=300  # For CPU
GENERATION_TIMEOUT_COOLDOWN=60  # Cooldown after timeout

# ===========================
# FILE UPLOAD SETTINGS
# ===========================
MAX_FILE_SIZE=5242880  # 5MB
SUPPORTED_IMAGE_FORMATS=[".png",".jpg",".jpeg",".gif",".bmp",".tiff"]
SUPPORTED_DOC_FORMATS=[".pdf",".docx",".txt",".xlsx"]

# OCR Settings
OCR_MAX_IMAGE_SIZE=1500  # Max dimension for image resizing
OCR_MIN_CONFIDENCE=30  # Tesseract confidence threshold
OCR_LANGUAGE=eng  # OCR language
TESSERACT_PATH=C:\Program Files\Tesseract-OCR\tesseract.exe  # Windows path

# ===========================
# RESPONSE SETTINGS
# ===========================
MAX_RESPONSE_LENGTH=1000
SHORT_MESSAGE_THRESHOLD=20  # Skip model for messages shorter than this
MAX_SENTENCES_PER_RESPONSE=5  # Limit sentences for conciseness
PARAGRAPH_BREAK_LENGTH=150  # Break paragraphs at this length
SENTENCE_SIMILARITY_THRESHOLD=0.7  # Threshold for duplicate detection

# ===========================
# LANGUAGE DETECTION
# ===========================
LANGUAGE_CONFIDENCE_THRESHOLD=0.3
DEFAULT_LANGUAGE=english

# ===========================
# EMOTION CLASSIFICATION
# ===========================
EMOTION_CONFIDENCE_THRESHOLD=0.3
DEFAULT_EMOTION=neutral

# ===========================
# GREETING DETECTION
# ===========================
ENABLE_GREETING_DETECTION=true
GREETING_MAX_LENGTH=20  # Same as SHORT_MESSAGE_THRESHOLD

# ===========================
# CACHE SETTINGS
# ===========================
ENABLE_MODEL_CACHE=true
USE_CACHE=true
CACHE_TTL=3600  # Cache time-to-live in seconds

# ===========================
# WORKER & CONCURRENCY
# ===========================
MAX_WORKERS=2  # Thread pool workers
BATCH_SIZE=1  # Process one at a time
UVICORN_WORKERS=1  # Single worker for model consistency
LIMIT_CONCURRENCY=10  # Max concurrent requests

# ===========================
# LOGGING
# ===========================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_TO_FILE=true
LOG_TO_CONSOLE=true
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5
USE_JSON_LOGS=false

# ===========================
# PATHS
# ===========================
BASE_PATH=.  # Base directory
KNOWLEDGE_BASE_PATH=knowledge_base
VECTOR_STORE_PATH=vector_store
LOGS_PATH=logs
MODELS_PATH=models

# ===========================
# SERVER SETTINGS
# ===========================
HOST=0.0.0.0
PORT=8000
RELOAD=true  # Auto-reload on file changes
TIMEOUT_KEEP_ALIVE=300
TIMEOUT_GRACEFUL_SHUTDOWN=30

# ===========================
# HEALTH CHECK
# ===========================
HEALTH_CHECK_INTERVAL=30  # Seconds between health checks
DEGRADED_MODE_ENABLED=true  # Allow running without all models

# ===========================
# DEVELOPMENT/DEBUG
# ===========================
DEBUG_MODE=false
SHOW_PROMPTS=false  # Log prompts sent to model
SHOW_CONTEXTS=false  # Log retrieved contexts
MEASURE_PERFORMANCE=true  # Log performance metrics

# ===========================
# FEATURE FLAGS
# ===========================
ENABLE_OCR=true
ENABLE_FILE_UPLOAD=true
ENABLE_CONTEXT_SEARCH=true
ENABLE_EMOTION_DETECTION=true
ENABLE_LANGUAGE_DETECTION=true

# ===========================
# CONTACT INFORMATION
# ===========================
CUSTOMER_SERVICE_NUMBER=(+632) 889-10000
COMPANY_NAME=BPI
COMPANY_FULL_NAME=Bank of the Philippine Islands

# ===========================
# RATE LIMITING (if needed)
# ===========================
RATE_LIMIT_ENABLED=false
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=3600  # In seconds (1 hour)

# ===========================
# SECURITY
# ===========================
ALLOWED_HOSTS=["localhost", "127.0.0.1", "0.0.0.0"]
TRUSTED_HOSTS=["localhost", "127.0.0.1"]
DISABLE_DOCS=false  # Set to true in production
DISABLE_REDOC=false  # Set to true in production